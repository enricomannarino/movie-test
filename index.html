<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test dei Gusti Cinematografici</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .animate-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="app"></div>

    <script>
        const movies = [
            { id: 1, title: "Il Padrino", year: 1972, img: "üé¨" },
            { id: 2, title: "Pulp Fiction", year: 1994, img: "üíº" },
            { id: 3, title: "Inception", year: 2010, img: "üåÄ" },
            { id: 4, title: "La La Land", year: 2016, img: "üé≠" },
            { id: 5, title: "Parasite", year: 2019, img: "üè†" },
            { id: 6, title: "Il Signore degli Anelli", year: 2001, img: "üíç" },
            { id: 7, title: "Matrix", year: 1999, img: "üï∂Ô∏è" },
            { id: 8, title: "Forrest Gump", year: 1994, img: "üèÉ" },
            { id: 9, title: "Interstellar", year: 2014, img: "üöÄ" },
            { id: 10, title: "Blade Runner", year: 1982, img: "üåÉ" },
            { id: 11, title: "La Vita √® Bella", year: 1997, img: "üé™" },
            { id: 12, title: "Schindler's List", year: 1993, img: "üïØÔ∏è" },
            { id: 13, title: "Il Cavaliere Oscuro", year: 2008, img: "ü¶á" },
            { id: 14, title: "Shining", year: 1980, img: "ü™ì" },
            { id: 15, title: "2001: Odissea nello Spazio", year: 1968, img: "üõ∏" }
        ];

        const MY_FIXED_RATINGS = {
            1: 10, // Il Padrino
            2: 7,  // Pulp Fiction
            3: 8,  // Inception
            4: 0,  // La La Land
            5: 7,  // Parasite
            6: 10, // Il Signore degli Anelli
            7: 9,  // Matrix
            8: 8,  // Forrest Gump
            9: 8,  // Interstellar
            10: 6, // Blade Runner
            11: 7, // La Vita √® Bella
            12: 0, // Schindler's List
            13: 8, // Il Cavaliere Oscuro
            14: 9, // Shining
            15: 0  // 2001
        };

        let state = {
            userRatings: {},
            currentIndex: 0,
            slideDirection: '',
            showResult: false
        };

        function handleRating(rating) {
            const currentMovie = movies[state.currentIndex];
            state.userRatings[currentMovie.id] = rating;
            state.slideDirection = 'left';
            render();
            
            setTimeout(() => {
                if (state.currentIndex < movies.length - 1) {
                    state.currentIndex++;
                    state.slideDirection = '';
                    render();
                } else {
                    state.showResult = true;
                    render();
                }
            }, 300);
        }

        function calculateCompatibility() {
            let totalDiff = 0;
            let count = 0;

            movies.forEach(movie => {
                const myRate = MY_FIXED_RATINGS[movie.id] || 0;
                const userRate = state.userRatings[movie.id] || 0;
                
                if (myRate !== 0 && userRate !== 0) {
                    totalDiff += Math.abs(myRate - userRate);
                    count++;
                }
            });

            if (count === 0) return 0;
            const avgDiff = totalDiff / count;
            const compatibility = Math.max(0, 100 - (avgDiff * 10));
            return Math.round(compatibility) || 0;
        }

        function getCompatibilityMessage(score) {
            if (score >= 90) return "Siamo anime gemelle cinematografiche! üíï √à come se vedessimo il mondo attraverso la stessa lente...";
            if (score >= 75) return "C'√® una bellissima sintonia tra noi! üåü I nostri cuori battono quasi allo stesso ritmo davanti allo schermo.";
            if (score >= 60) return "Abbiamo molte cose in comune! üí´ Le nostre serate cinema insieme sarebbero perfette.";
            if (score >= 40) return "Ci sono punti d'incontro interessanti... üé¨ Le nostre differenze ci renderebbero curiosi l'uno dell'altra.";
            return "Abbiamo gusti molto diversi! üé≠ Ma sai cosa? Le discussioni pi√π belle nascono dalle differenze...";
        }

        function render() {
            const app = document.getElementById('app');
            
            if (state.showResult) {
                const compatibility = calculateCompatibility();
                const myCount = Object.values(MY_FIXED_RATINGS).filter(r => r > 0).length;
                const userCount = Object.values(state.userRatings).filter(r => r > 0).length;
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-purple-900 via-pink-800 to-red-900 flex items-center justify-center p-4">
                        <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 max-w-md w-full text-white shadow-2xl">
                            <div class="text-center mb-6">
                                <div class="text-6xl mb-4 animate-pulse">‚ù§Ô∏è</div>
                                <h2 class="text-3xl font-bold mb-4">Risultato</h2>
                            </div>
                            
                            <div class="bg-white/20 rounded-2xl p-6 mb-6">
                                <div class="text-6xl font-bold text-center mb-2">${compatibility}%</div>
                                <div class="text-center text-lg opacity-90">Compatibilit√†</div>
                            </div>

                            <p class="text-lg text-center leading-relaxed mb-8 italic">
                                ${getCompatibilityMessage(compatibility)}
                            </p>

                            <div class="grid grid-cols-2 gap-4 text-sm">
                                <div class="bg-white/10 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold">${myCount}</div>
                                    <div class="opacity-75">Miei film visti</div>
                                </div>
                                <div class="bg-white/10 rounded-xl p-4 text-center">
                                    <div class="text-2xl font-bold">${userCount}</div>
                                    <div class="opacity-75">Tuoi film visti</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                const currentMovie = movies[state.currentIndex];
                const progress = ((state.currentIndex + 1) / movies.length) * 100;
                
                app.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-800 to-pink-800 flex items-center justify-center p-4">
                        <div class="max-w-md w-full">
                            <div class="text-center mb-6">
                                <div class="text-5xl mb-3">üé¨</div>
                                <h1 class="text-2xl font-bold text-white mb-2">Valuta i film</h1>
                                <div class="text-white/80 text-sm">
                                    Film ${state.currentIndex + 1} di ${movies.length}
                                </div>
                            </div>

                            <div class="mb-4">
                                <div class="bg-white/20 rounded-full h-2 overflow-hidden">
                                    <div class="bg-white h-full transition-all duration-300" style="width: ${progress}%"></div>
                                </div>
                            </div>

                            <div class="bg-white/10 backdrop-blur-lg rounded-3xl p-8 shadow-2xl transition-all duration-300 ${state.slideDirection === 'left' ? 'opacity-0' : 'opacity-100'}">
                                <div class="text-center mb-8">
                                    <div class="text-8xl mb-4">${currentMovie.img}</div>
                                    <h2 class="text-3xl font-bold text-white mb-2">${currentMovie.title}</h2>
                                    <p class="text-white/70 text-lg">${currentMovie.year}</p>
                                </div>

                                <div class="space-y-3">
                                    <button onclick="handleRating(0)" class="w-full bg-white/20 hover:bg-white/30 text-white py-4 rounded-2xl font-semibold transition-all transform hover:scale-105">
                                        Non l'ho visto
                                    </button>
                                    
                                    <div class="grid grid-cols-5 gap-2 mb-2">
                                        ${[1, 2, 3, 4, 5].map(rating => `
                                            <button onclick="handleRating(${rating})" class="bg-gradient-to-br from-red-500 to-orange-600 hover:from-red-600 hover:to-orange-700 text-white py-3 rounded-xl font-bold transition-all transform hover:scale-110">
                                                ${rating}
                                            </button>
                                        `).join('')}
                                    </div>
                                    <div class="grid grid-cols-5 gap-2">
                                        ${[6, 7, 8, 9, 10].map(rating => `
                                            <button onclick="handleRating(${rating})" class="bg-gradient-to-br from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-3 rounded-xl font-bold transition-all transform hover:scale-110">
                                                ${rating}${rating === 10 ? '‚≠ê' : ''}
                                            </button>
                                        `).join('')}
                                    </div>
                                    <div class="text-center text-white/60 text-xs mt-2">
                                        Valuta da 1 a 10
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        window.handleRating = handleRating;
        render();
    </script>
</body>
</html>
